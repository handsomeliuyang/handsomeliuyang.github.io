(t=>{function e(){this.record=[],this.timeoutMap={},this.listeners={start:[],frame:[],end:[]},this.frames=0,this._init()}e.prototype={_init:function(){return this.index=0,this.nowIndex=0,this.timer=null,this.time=0,this.startTime=null,this.record.forEach(function(i){eachObj(i,function(t,e){~e.indexOf("_")||(i[e].now=i[e].from)})}),this},_getSpendTime:function(){var t=this.time,n=this.nowIndex;return t-this.record.reduce(function(t,e,i){return i<n&&(t+=e._time),t},0)},_request:function(t){var e=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;return this.timer=e(t),this},_cancel:function(){return(window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame)(this.timer),this},_algorithm:function(t){var e=t.type||"linear",i=t.time||1e3,n=t.now,r=t.aims||0,t=t.spendTime||0;if("linear"===e)return i=(e={time:i,now:n,aims:r,spendTime:t}).time,i=(n=e.now)+60*((r=e.aims)-n)/(i-e.spendTime),0<r-n?r<=i?r:i:i<=r?r:i},_emit:function(t,e){return this.listeners[t]&&this.listeners[t].forEach(function(t){t(e)}),this},on:function(t,e){return~getKeys(this.listeners).indexOf(t)&&e&&this.listeners[t].push(e),this},from:function(t){t=t||{};var i=this.record[this.index]||{};return eachObj(t,function(t,e){i[e]={from:t,now:t,to:0}}),this.record[this.index]=i,this},to:function(t){t=t||{};var i=this.record[this.index]||{};return eachObj(t,function(t,e){i[e]=extend(i[e]||{from:0,now:0},{to:t})}),this.record[this.index]=i,this},transition:function(t){var e,t="string"==typeof t?t:(e=t.type||"linear",t.time||1e3),i=this.record[this.index]||{};return extend(i,{_time:t,_type:e}),this.record[this.index]=i,this},next:function(){return this.index=this.record.length,this},timeout:function(t){var e;return t&&"number"==typeof t&&(e=0===this.record.length?-1:this.index,this.timeoutMap[e]=null!=this.timeoutMap[e]?this.timeoutMap[e]+t:t),this},start:function(){var i=this.record,o=this;return this.next()._emit("start")._request(function t(){var n=i[o.nowIndex],r={};if(!o.startTime&&o.timeoutMap[-1])o.startTime=(new Date).getTime(),o.pause(),setTimeout(function(){o._request(t)},o.timeoutMap[-1]);else{if(o.time===n._time){var e=o.timeoutMap[o.nowIndex];if(o.time=0,o.nowIndex++,e)return o.pause(),void setTimeout(function(){o._request(t)},e);n=i[o.nowIndex]}o.nowIndex===i.length?o._emit("end").close():(eachObj(n,function(t,e){var i;~e.indexOf("_")||(i=o._algorithm({type:n._type,time:n._time,now:t.now,aims:t.to,spendTime:o.time}),r[e]=i,(n[e].now=i)===t.to&&(o.time=n._time))}),o.time!=n._time&&(o.time+=60),o._emit("frame",r),o.frames++,o._request(t))}})},pause:function(){return this._cancel()},close:function(){return this._cancel()._init()}},t.Amt=e})(window);